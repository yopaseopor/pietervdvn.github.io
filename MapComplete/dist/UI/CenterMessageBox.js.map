{"version":3,"sources":["UI/UIElement.ts","UI/UIEventSource.ts","Helpers.ts","UI/CenterMessageBox.ts"],"names":[],"mappings":";;;;;;;AEGA,AFDA,ACFA,ICGA,AFDA,ACFA,OCGA,EFDA,ICFA;ACGA,AFDA,ACFA;ACGA,AFDA,ACFA,YCGA,AFDA,ACFA;ACGA,AFKI,ACHA,WCFJ,AFKI,ACHA,OCFJ,EFKI,CELJ,AFK0B,CEyCzB,ED5CG,CAAY,EDGZ,EAAgD,ACHhD,EAAmB;ACCnB,AFGI,ACNI,SDMC,ACND,EDMJ,GAAU,KCNN,GAAa,EAAb,MDMsB,SAAS,CAAC,MAApC;AACA,ACJA,IDIA,KCJK,IDII,ACJT,CDIU,ECJE,IDIZ,ACJA;ADKA,ACJH,SDIQ,QAAL,CAAc,MAAd;AACH;ACFM,EAAA,aAAA,CAAA,SAAA,CAAA,WAAA,GAAP,UAAmB,QAAnB,EAA0C;ADKhC,ACJN,EDIM,OCJD,EDIC,CAAA,OCJN,CAAgB,CDIV,CAAA,ECJN,CAAqB,KDIf,GAAV,ACJI,UDIe,MAAnB,EAA6C;AELtC,AFMH,ACJH,ECFM,CDAA,KDMA,CENA,CAAA,IFMM,KAAK,SAAd,EAAwB,kBENrB,GAAP,UAA8C,aAA9C,EAA2E;AAEvE,AFKI,QELE,YAAY,GAAG,QAAQ,CAAC,sBAAT,CAAgC,6BAAhC,CAArB;AACA,AFKC,ACJE,EAAA,ECDH,OAAO,CAAC,GAAR,ADCG,CCDS,ADCT,SAAA,CAAA,ECDH,KDCG,GAAP,UAAe,CAAf,EAAoB;AAChB,QAAG,KAAK,IAAL,KAAc,CAAjB,EAAmB;ACDnB,AFKA,ACHI,QDGE,CELD,GFKK,CELD,CAAC,CFKG,EELA,CAAb,CFKA,CELgB,CAAC,GAAG,YAAY,CAAC,MAAjC,EAAyC,CAAC,EAA1C,EAA8C;AAC1C,AFKJ,ACHC,IDGD,MELQ,AFKF,CAAC,MELQ,GAAG,EFKlB,CAAmB,SELW,CAAC,EFKZ,EELD,CAAkB,CAAlB,CAAd,CAD0C,CAE1C;AFKA,MAAA,IAAI,CAAC,MAAL;AEJA,AFKH,ACJD,KDEA,CEHI,GDCC,ICDM,ADCX,CCDY,EDCA,CAAZ,ICDI,GAAkB,YAAA;AACd,AFKX,ACJG,GDJM,KEGE,CDCH,IAAL,QCDqB,CAAC,YAAd;AACH,ADCR,GANM,ICGC;AAGH,AFKL,EAAA,SAAA,CAAA,SAAA,CAAA,MAAA,GAAA,YAAA;AEJC,AFKG,ACJG,EAAA,CCZA,KFgBC,OAAO,ACJR,CAAA,EDIY,OCJZ,CDIoB,ACJpB,CDIqB,GCJrB,GAAP,QDImB,CAAwB,GCJ3C,EDIgD,EAA7B,CAAf;AEFJ,ADDI,SAAI,IAAI,CAAR,IAAa,KAAK,UAAlB,EAA6B;ADI7B,ACHI,QDGA,GCHK,IDGE,KAAK,CCHZ,CAAgB,CAAhB,CDGA,IAAoB,OAAO,KAAK,SAApC,EAA+C;AAC3C,ACHH;ADIG,ACHP,GAJM;AEtBX,AH8BS,IG9BT,WAAA,GAAA,OAAA,CAAA,aAAA,CAAA;AF6BA,SAAA,aAAA;AE3BA,AH8BQ,AChCR,CAAA,EAAA,CEEA,AH8BQ,OAAO,CAAC,OG9BhB,EH8BQ,CG9BR,EH8B4B,KG9B5B,AH8BiC,CG9BjC,UH8B4B,EAApB,KG9BR,CAAA;AH+BQ,SAAK,WAAL,CAAiB,OAAjB;AEHG,AC3BX,AH+BK,AClCQ,EC8BF,CFLP,CGtBJ,GFHa,CAAA,CC8BF,CAAA,GC3BX,GAAA,KFHa,EEGb,CD2BW,AC3BX,AFHa,GC8BT,SC3BJ,CD2B0B,AC3B1B,AFHa,OC8BT,EAAuC;AAEnC,IAAA,MAAM,CAAC,gBAAP,CAAwB,cAAxB,EAAwC,UAAU,CAAV,EAAW;AAC/C,AC3BZ,AHiCI,EAAA,EGjCJ,OHiCI,CAAA,QGjCJ,CHiCI,CAAA,MAAA,GAAA,YAAA;AELQ,AC5BZ,AHkCQ,UENQ,CFMD,MENQ,CAAC,eAAR,CAAwB,MAAxB,GFM+B,CENG,CAAtC,EAAyC,CFMD,EAArC,GAA0C,IAA1C,GAAiD,KAAK,WAAL,EAAjD,GAAsE,QAA7E;AELQ,AC7BhB,AHmCK,GAFD,OGjCJ,KD6BuB,CC7BvB,CD6BgB,CC7BhB;AD8Ba,AC9ByB,EAAA,SAAA,CAAA,gBAAA,EAAA,MAAA,CAAA;AHqClC,EAAA,SAAA,CAAA,SAAA,CAAA,QAAA,GAAA,UAAS,KAAT,EAAsB;AELd,ACzBR,AH+BI,MENI,EFMA,GG/BR,EDyBe,CAAC,CFMD,GAAG,KENV,CAAkB,EFMA,CG/B1B,AH+B2B,CG/Bf,QDyBc,KCzB1B,AH+BkB,CAAwB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","file":"CenterMessageBox.js","sourceRoot":"..","sourcesContent":["import {UIEventSource} from \"./UIEventSource\";\n\nexport abstract class UIElement {\n\n    private static nextId: number = 0;\n\n    public readonly id: string;\n\n    protected constructor(source: UIEventSource<any>) {\n        this.id = \"ui-element-\" + UIElement.nextId;\n        UIElement.nextId++;\n        this.ListenTo(source);\n    }\n\n\n    protected ListenTo(source: UIEventSource<any>) {\n        if(source === undefined){\n            return;\n        }\n        const self = this;\n        source.addCallback(() => {\n            self.Update();\n        })\n    }\n\n    Update(): void {\n        let element  = document.getElementById(this.id);\n        if (element === null || element === undefined) {\n            // The element is not painted\n            return;\n        }\n        \n        element.innerHTML = this.InnerRender();\n        this.InnerUpdate(element);\n    }\n    \n    // Called after the HTML has been replaced. Can be used for css tricks\n    abstract InnerUpdate(htmlElement : HTMLElement);\n\n    Render(): string {\n        return \"<div class='uielement' id='\" + this.id + \"'>\" + this.InnerRender() + \"</div>\"\n    }\n\n    AttachTo(divId: string) {\n        let element = document.getElementById(divId);\n        element.innerHTML = this.Render();\n    }\n\n    protected abstract InnerRender(): string;\n\n    public IsEmpty(): boolean {\n        return this.InnerRender() === \"\";\n    }\n\n}","export class UIEventSource<T>{\n    \n    public data : T;\n    private _callbacks = [];\n    \n    constructor(data :T){\n        this.data = data;\n    }\n    \n    \n    public addCallback(callback : (() => void)){\n        this._callbacks.push(callback);\n    }\n    \n    public setData(t : T) : void{\n        if(this.data === t){\n            return;\n        }\n        this.data = t;\n        this.ping();\n    }\n    \n    public ping():void{\n        for(let i in this._callbacks){\n            this._callbacks[i]();\n        }\n    }\n\n\n}","import {OsmConnection} from \"./Logic/OsmConnection\";\nimport {Changes} from \"./Logic/Changes\";\n\nexport class Helpers {\n\n\n    /**\n     * All elements with class 'activate-osm-authentication' are loaded and get an 'onclick' to authenticate\n     * @param osmConnection\n     */\n    static registerActivateOsmAUthenticationClass(osmConnection : OsmConnection) {\n\n        const authElements = document.getElementsByClassName(\"activate-osm-authentication\");\n        console.log(authElements);\n        for (let i = 0; i < authElements.length; i++) {\n            let element = authElements.item(i);\n            // @ts-ignore\n            element.onclick = function () {\n                osmConnection.AttemptLogin();\n            }\n        }\n    }\n    \n    \n    /*\n    * Registers an action that:\n    * -> Upload everything to OSM\n    * -> Asks the user not to close. The 'not to close' dialog should profide enough time to upload\n    * -> WHen uploading is done, the window is closed anyway\n     */\n    static LastEffortSave(changes : Changes){\n\n        window.addEventListener(\"beforeunload\", function (e) {\n            // Quickly save everyting!\n            if (changes._pendingChanges.length == 0) {\n                return \"\";\n            }\n\n            changes.uploadAll(function () {\n                window.close()\n            });\n            var confirmationMessage = \"Nog even geduld - je laatset wijzigingen worden opgeslaan!\";\n\n            (e || window.event).returnValue = confirmationMessage; //Gecko + IE\n            return confirmationMessage;                            //Webkit, Safari, Chrome\n        });\n\n    }\n\n}","import {UIElement} from \"./UIElement\";\nimport {OverpassLayer} from \"../Logic/OverpassLayer\";\nimport {UIEventSource} from \"./UIEventSource\";\nimport {Helpers} from \"../Helpers\";\nimport {OsmConnection} from \"../Logic/OsmConnection\";\n\nexport class CenterMessageBox extends UIElement {\n    private location: UIEventSource<{ zoom: number }>;\n    private readonly layers: OverpassLayer[];\n    private zoomInMore = new UIEventSource<boolean>(true);\n    private centermessage: UIEventSource<string>;\n    private readonly  osmConnection: OsmConnection;\n\n    constructor(centermessage: UIEventSource<string>,\n                osmConnection: OsmConnection,\n                location: UIEventSource<{ zoom: number }>, layers: OverpassLayer[]) {\n        super(centermessage);\n        this.centermessage = centermessage;\n        this.location = location;\n        this.layers = layers;\n        this.osmConnection = osmConnection;\n\n        let minZoomForAll = 0;\n        for (const i in layers) {\n            let l = layers[i];\n            minZoomForAll = Math.max(minZoomForAll, l.minzoom);\n            this.ListenTo(l.queryState);\n        }\n        const self = this;\n        location.addCallback(function () {\n            self.zoomInMore.setData(location.data.zoom < minZoomForAll);\n        });\n        this.ListenTo(this.zoomInMore);\n\n    }\n\n    protected InnerRender(): string {\n\n        if (this.centermessage.data != \"\") {\n            return this.centermessage.data;\n        }\n\n        if (this.zoomInMore.data) {\n            return \"Zoom in om de data te zien en te bewerken\";\n        } else {\n            for (const i in this.layers) {\n                let l = this.layers[i];\n                if (l.queryState.data) {\n                    return \"Data wordt geladen...\";\n                }\n            }\n        }\n        return \"Klaar!\";\n    }\n\n\n    private ShouldShowSomething() {\n        for (const i in this.layers) {\n            let l = this.layers[i];\n            if (l.queryState.data) {\n                return true;\n            }\n        }\n        return this.zoomInMore.data;\n    }\n\n    InnerUpdate(htmlElement: HTMLElement) {\n        const pstyle = htmlElement.parentElement.style;\n        if (this.centermessage.data != \"\") {\n            pstyle.opacity = \"1\";\n            pstyle.pointerEvents = \"all\";\n            Helpers.registerActivateOsmAUthenticationClass(this.osmConnection);\n            return;\n        }\n        pstyle.pointerEvents = \"none\";\n\n\n        if (this.ShouldShowSomething()) {\n            pstyle.opacity = \"0.5\";\n        } else {\n            pstyle.opacity = \"0\";\n        }\n    }\n\n}\n\n\n"]}