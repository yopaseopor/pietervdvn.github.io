{"version":3,"sources":["UI/UIElement.ts","UI/TagMapping.ts"],"names":[],"mappings":"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","file":"TagMapping.js","sourceRoot":"..","sourcesContent":["import {UIEventSource} from \"./UIEventSource\";\nimport {Playground} from \"../Layers/Playground\";\n\nexport abstract class UIElement {\n\n    private static nextId: number = 0;\n\n    public readonly id: string;\n    public readonly _source: UIEventSource<any>;\n    \n    private _hideIfEmpty = false;\n\n    protected constructor(source: UIEventSource<any>) {\n        this.id = \"ui-element-\" + UIElement.nextId;\n        this._source = source;\n        UIElement.nextId++;\n        this.ListenTo(source);\n    }\n\n\n    protected ListenTo(source: UIEventSource<any>) {\n        if (source === undefined) {\n            return;\n        }\n        const self = this;\n        source.addCallback(() => {\n            self.Update();\n        })\n    }\n\n    private _onClick: () => void;\n\n    public onClick(f: (() => void)) {\n        this._onClick = f;\n        this.Update();\n        return this;\n    }\n\n    Update(): void {\n        let element = document.getElementById(this.id);\n        if (element === null || element === undefined) {\n            // The element is not painted\n            return;\n        }\n\n        element.innerHTML = this.InnerRender();\n        if (this._hideIfEmpty) {\n            if (element.innerHTML === \"\") {\n                element.parentElement.style.display = \"none\";\n            } else {\n                element.parentElement.style.display = undefined;\n            }\n        }\n\n        if (this._onClick !== undefined) {\n            const self = this;\n            element.onclick = () => {\n                self._onClick();\n            }\n            element.style.pointerEvents = \"all\";\n            element.style.cursor = \"pointer\";\n        }\n\n        this.InnerUpdate(element);\n    }\n    \n    HideOnEmpty(hide : boolean){\n        this._hideIfEmpty = hide;\n        this.Update();\n        return this;\n    }\n    \n    // Called after the HTML has been replaced. Can be used for css tricks\n    InnerUpdate(htmlElement : HTMLElement){}\n\n    Render(): string {\n        return \"<span class='uielement' id='\" + this.id + \"'>\" + this.InnerRender() + \"</span>\"\n    }\n\n    AttachTo(divId: string) {\n        let element = document.getElementById(divId);\n        if(element === null){\n            console.log(\"SEVERE: could not attach UIElement to \", divId);\n            return;\n        }\n        element.innerHTML = this.Render();\n        this.Update();\n        return this;\n    }\n\n    protected abstract InnerRender(): string;\n    public Activate(): void {};\n\n    public IsEmpty(): boolean {\n        return this.InnerRender() === \"\";\n    }\n\n}","import {UIElement} from \"./UIElement\";\nimport {UIEventSource} from \"./UIEventSource\";\n\n\nexport class TagMappingOptions {\n    key: string;// The key to show\n    mapping?: any;// dictionary for specific values, the values are substituted \n    template?: string; // The template, where {key} will be substituted\n    missing?: string// What to show when the key is not there\n    freeform?: ((string) => string) // Freeform template function, only applied on the value if nothing matches\n\n    /**\n     * If true, deletion is allowed by pressing 'x'\n     */\n    public allowDelete: boolean;\n\n    constructor(options: {\n        key: string,\n        allowDelete?: boolean,\n        mapping?: any,\n        template?: string,\n        missing?: string\n        freeform?: ((string) => string)\n    }) {\n        this.key = options.key;\n        this.mapping = options.mapping;\n        this.template = options.template;\n        this.missing = options.missing;\n        this.freeform = options.freeform;\n        this.allowDelete = options.allowDelete ?? false;\n    }\n\n}\n\nexport class TagMapping extends UIElement {\n\n    private readonly tags;\n    private readonly options: TagMappingOptions;\n\n    constructor(\n        options: TagMappingOptions,\n        tags: UIEventSource<any>) {\n        super(tags);\n        this.tags = tags.data;\n        this.options = options;\n    }\n\n    IsEmpty(): boolean {\n        const o = this.options;\n        return this.tags[o.key] === undefined && o.missing === undefined;\n    }\n\n    protected InnerRender(): string{\n        \n        const attrRender = this.RenderAttribute();\n        if(this.options.allowDelete){\n            return attrRender + \"X\";\n        }\n        return attrRender;\n    }\n\n    private RenderAttribute(): string {\n\n        const o = this.options;\n        const v = this.tags[o.key];\n\n        if (v === undefined) {\n            if (o.missing === undefined) {\n                return \"\";\n            }\n            return o.missing;\n        }\n\n        if (o.mapping !== undefined) {\n\n            const mapped = o.mapping[v];\n            if (mapped !== undefined) {\n                return mapped;\n            }\n        }\n\n        if (o.template !== undefined) {\n            return o.template.replace(\"{\" + o.key + \"}\", v);\n        }\n\n        if(o.freeform !== undefined){\n            return o.freeform(v);\n        }\n        \n        console.log(\"Warning: no match for \" + o.key + \"=\" + v);\n        return v;\n    }\n    InnerUpdate(htmlElement: HTMLElement) {\n    }\n\n}"]}