{"version":3,"sources":["UI/UIElement.ts","UI/PendingChanges.ts"],"names":[],"mappings":"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","file":"PendingChanges.js","sourceRoot":"..","sourcesContent":["import {UIEventSource} from \"./UIEventSource\";\nimport {Playground} from \"../Layers/Playground\";\n\nexport abstract class UIElement {\n\n    private static nextId: number = 0;\n\n    public readonly id: string;\n    public readonly _source: UIEventSource<any>;\n    \n    private _hideIfEmpty = false;\n\n    protected constructor(source: UIEventSource<any>) {\n        this.id = \"ui-element-\" + UIElement.nextId;\n        this._source = source;\n        UIElement.nextId++;\n        this.ListenTo(source);\n    }\n\n\n    protected ListenTo(source: UIEventSource<any>) {\n        if (source === undefined) {\n            return;\n        }\n        const self = this;\n        source.addCallback(() => {\n            self.Update();\n        })\n    }\n\n    private _onClick: () => void;\n\n    public onClick(f: (() => void)) {\n        this._onClick = f;\n        this.Update();\n        return this;\n    }\n\n    Update(): void {\n        let element = document.getElementById(this.id);\n        if (element === null || element === undefined) {\n            // The element is not painted\n            return;\n        }\n\n        element.innerHTML = this.InnerRender();\n        if (this._hideIfEmpty) {\n            if (element.innerHTML === \"\") {\n                element.parentElement.style.display = \"none\";\n            } else {\n                element.parentElement.style.display = undefined;\n            }\n        }\n\n        if (this._onClick !== undefined) {\n            const self = this;\n            element.onclick = () => {\n                self._onClick();\n            }\n            element.style.pointerEvents = \"all\";\n            element.style.cursor = \"pointer\";\n        }\n\n        this.InnerUpdate(element);\n    }\n    \n    HideOnEmpty(hide : boolean){\n        this._hideIfEmpty = hide;\n        this.Update();\n        return this;\n    }\n    \n    // Called after the HTML has been replaced. Can be used for css tricks\n    InnerUpdate(htmlElement : HTMLElement){}\n\n    Render(): string {\n        return \"<span class='uielement' id='\" + this.id + \"'>\" + this.InnerRender() + \"</span>\"\n    }\n\n    AttachTo(divId: string) {\n        let element = document.getElementById(divId);\n        if(element === null){\n            console.log(\"SEVERE: could not attach UIElement to \", divId);\n            return;\n        }\n        element.innerHTML = this.Render();\n        this.Update();\n        return this;\n    }\n\n    protected abstract InnerRender(): string;\n    public Activate(): void {};\n\n    public IsEmpty(): boolean {\n        return this.InnerRender() === \"\";\n    }\n\n}","import {UIElement} from \"./UIElement\";\nimport {UIEventSource} from \"./UIEventSource\";\n\nexport class PendingChanges extends UIElement {\n    private _pendingChangesCount: UIEventSource<number>;\n    private _countdown: UIEventSource<number>;\n    private _isSaving: UIEventSource<boolean>;\n\n    constructor(pendingChangesCount: UIEventSource<number>,\n                countdown: UIEventSource<number>,\n                isSaving: UIEventSource<boolean>) {\n        super(pendingChangesCount);\n        this.ListenTo(isSaving);\n        this.ListenTo(countdown);\n        this._pendingChangesCount = pendingChangesCount;\n        this._countdown = countdown;\n        this._isSaving = isSaving;\n    }\n\n    protected InnerRender(): string {\n        if (this._isSaving.data) {\n            return \"<span class='alert'>Saving</span>\";\n        }\n        if (this._pendingChangesCount.data == 0) {\n            return \"\";\n        }\n\n        var restingSeconds = this._countdown.data / 1000;\n        var dots = \"\";\n        while (restingSeconds > 0) {\n            dots += \".\";\n            restingSeconds = restingSeconds - 1;\n        }\n        return \"Saving \"+this._pendingChangesCount.data;\n    }  \n    \n}"]}